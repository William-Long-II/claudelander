<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Settings - ClaudeLander</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 24px 40px;
      margin: 0;
      user-select: none;
    }

    .settings-container {
      width: 100%;
      max-width: none;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #3c3c3c;
    }

    .header h1 {
      font-size: 20px;
      font-weight: 600;
      background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .close-btn {
      background: none;
      border: none;
      color: #888;
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
    }

    .close-btn:hover {
      color: #fff;
    }

    .section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #888;
      margin-bottom: 12px;
    }

    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #2d2d2d;
      gap: 20px;
    }

    .setting-row:last-child {
      border-bottom: none;
    }

    .setting-info {
      flex: 1;
      min-width: 0;
    }

    .setting-label {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .setting-description {
      font-size: 12px;
      color: #888;
    }

    .setting-control {
      flex-shrink: 0;
    }

    .toggle {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      width: 44px;
      height: 24px;
      background-color: #3a3a3a;
      border: 2px solid #666;
      border-radius: 24px;
      transition: all 0.3s ease;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      top: 2px;
      background-color: #888;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .toggle input:checked + .toggle-slider {
      background-color: #ff8c00;
      border-color: #ffd700;
    }

    .toggle input:checked + .toggle-slider:before {
      transform: translateX(20px);
      background-color: #1e1e1e;
    }

    .text-input {
      background: #2d2d2d;
      border: 1px solid #3c3c3c;
      color: #d4d4d4;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 13px;
      width: 350px;
    }

    .text-input:focus {
      outline: none;
      border-color: #ff8c00;
    }

    .text-input::placeholder {
      color: #666;
    }

    .range-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .range {
      -webkit-appearance: none;
      width: 150px;
      height: 4px;
      background: #3c3c3c;
      border-radius: 2px;
      outline: none;
    }

    .range::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
      border-radius: 50%;
      cursor: pointer;
    }

    .range-value {
      font-size: 13px;
      color: #888;
      min-width: 40px;
      text-align: right;
    }

    .footer {
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid #3c3c3c;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .btn {
      padding: 8px 20px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-secondary {
      background: #3c3c3c;
      border: 1px solid #555;
      color: #d4d4d4;
    }

    .btn-secondary:hover {
      background: #4c4c4c;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
      border: none;
      color: #1e1e1e;
      font-weight: 600;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    .hint {
      font-size: 11px;
      color: #666;
      margin-top: 4px;
    }

    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-left: 8px;
    }

    .status-saved {
      background: #4caf50;
    }

    .status-unsaved {
      background: #ff8c00;
    }
  </style>
</head>
<body>
  <div class="settings-container">
    <div class="header">
      <h1>Settings <span class="status-indicator" id="saveStatus"></span></h1>
      <button class="close-btn" onclick="window.close()" title="Close">&times;</button>
    </div>

    <div class="section">
      <div class="section-title">Sessions</div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Auto-launch Claude</div>
          <div class="setting-description">Automatically start Claude when creating new sessions</div>
        </div>
        <div class="setting-control">
          <label class="toggle">
            <input type="checkbox" id="autoLaunchClaude" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Custom Shell Path</div>
          <div class="setting-description">Full path to shell executable (leave empty for auto-detect)</div>
          <div class="hint" id="shellHint"></div>
        </div>
        <div class="setting-control">
          <input type="text" class="text-input" id="customShellPath" placeholder="Auto-detect">
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Appearance</div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Show Splash Screen</div>
          <div class="setting-description">Display splash screen on startup</div>
        </div>
        <div class="setting-control">
          <label class="toggle">
            <input type="checkbox" id="showSplash" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Splash Duration</div>
          <div class="setting-description">How long to show the splash screen</div>
        </div>
        <div class="setting-control">
          <div class="range-container">
            <input type="range" class="range" id="splashDuration" min="1" max="5" step="0.5" value="2.5">
            <span class="range-value" id="splashDurationValue">2.5s</span>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Notifications & System Tray</div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Enable Notifications</div>
          <div class="setting-description">Show system notifications when sessions need attention</div>
        </div>
        <div class="setting-control">
          <label class="toggle">
            <input type="checkbox" id="enableNotifications" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Notification Sound</div>
          <div class="setting-description">Play sound with notifications</div>
        </div>
        <div class="setting-control">
          <label class="toggle">
            <input type="checkbox" id="notificationSound" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Close to Tray</div>
          <div class="setting-description">Minimize to system tray instead of quitting when closing window</div>
        </div>
        <div class="setting-control">
          <label class="toggle">
            <input type="checkbox" id="closeToTray" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Terminal</div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Font Size</div>
          <div class="setting-description">Terminal text size</div>
        </div>
        <div class="setting-control">
          <div class="range-container">
            <input type="range" class="range" id="fontSize" min="10" max="24" step="1" value="14">
            <span class="range-value" id="fontSizeValue">14px</span>
          </div>
        </div>
      </div>

      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Enable WebGL Rendering</div>
          <div class="setting-description">Use GPU acceleration for terminal (recommended)</div>
        </div>
        <div class="setting-control">
          <label class="toggle">
            <input type="checkbox" id="webglRenderer" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>

    <div class="footer">
      <button class="btn btn-secondary" onclick="resetDefaults()">Reset to Defaults</button>
      <button class="btn btn-primary" onclick="saveAndClose()">Save & Close</button>
    </div>
  </div>

  <script>
    // Update range displays
    document.getElementById('splashDuration').addEventListener('input', (e) => {
      document.getElementById('splashDurationValue').textContent = e.target.value + 's';
      markUnsaved();
    });

    document.getElementById('fontSize').addEventListener('input', (e) => {
      document.getElementById('fontSizeValue').textContent = e.target.value + 'px';
      markUnsaved();
    });

    // Track changes
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('change', markUnsaved);
      input.addEventListener('input', markUnsaved);
    });

    function markUnsaved() {
      document.getElementById('saveStatus').className = 'status-indicator status-unsaved';
    }

    function markSaved() {
      document.getElementById('saveStatus').className = 'status-indicator status-saved';
    }

    // Platform-specific shell hints
    function updateShellHint() {
      const hint = document.getElementById('shellHint');
      if (window.settingsAPI && window.settingsAPI.platform === 'win32') {
        hint.textContent = 'Examples: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe or C:\\Windows\\System32\\cmd.exe';
      } else {
        hint.textContent = 'Examples: /bin/bash, /bin/zsh, /usr/bin/fish';
      }
    }

    // Load settings on page load
    async function loadSettings() {
      if (!window.settingsAPI) {
        console.warn('settingsAPI not available');
        return;
      }

      try {
        const settings = await window.settingsAPI.getAllSettings();

        document.getElementById('autoLaunchClaude').checked = settings.autoLaunchClaude === 'true';
        document.getElementById('customShellPath').value = settings.customShellPath || '';
        document.getElementById('showSplash').checked = settings.showSplash === 'true';
        document.getElementById('splashDuration').value = settings.splashDuration || '2.5';
        document.getElementById('splashDurationValue').textContent = (settings.splashDuration || '2.5') + 's';
        document.getElementById('enableNotifications').checked = settings.enableNotifications !== 'false';
        document.getElementById('notificationSound').checked = settings.notificationSound !== 'false';
        document.getElementById('closeToTray').checked = settings.closeToTray !== 'false';
        document.getElementById('fontSize').value = settings.fontSize || '14';
        document.getElementById('fontSizeValue').textContent = (settings.fontSize || '14') + 'px';
        document.getElementById('webglRenderer').checked = settings.webglRenderer === 'true';

        markSaved();
      } catch (err) {
        console.error('Failed to load settings:', err);
      }

      updateShellHint();
    }

    async function resetDefaults() {
      document.getElementById('autoLaunchClaude').checked = true;
      document.getElementById('customShellPath').value = '';
      document.getElementById('showSplash').checked = true;
      document.getElementById('splashDuration').value = 2.5;
      document.getElementById('splashDurationValue').textContent = '2.5s';
      document.getElementById('enableNotifications').checked = true;
      document.getElementById('notificationSound').checked = true;
      document.getElementById('closeToTray').checked = true;
      document.getElementById('fontSize').value = 14;
      document.getElementById('fontSizeValue').textContent = '14px';
      document.getElementById('webglRenderer').checked = true;
      markUnsaved();
    }

    async function saveAndClose() {
      if (!window.settingsAPI) {
        console.warn('settingsAPI not available');
        window.close();
        return;
      }

      try {
        await window.settingsAPI.setPreference('autoLaunchClaude',
          document.getElementById('autoLaunchClaude').checked.toString());
        await window.settingsAPI.setPreference('customShellPath',
          document.getElementById('customShellPath').value);
        await window.settingsAPI.setPreference('showSplash',
          document.getElementById('showSplash').checked.toString());
        await window.settingsAPI.setPreference('splashDuration',
          document.getElementById('splashDuration').value);
        await window.settingsAPI.setPreference('enableNotifications',
          document.getElementById('enableNotifications').checked.toString());
        await window.settingsAPI.setPreference('notificationSound',
          document.getElementById('notificationSound').checked.toString());
        await window.settingsAPI.setPreference('closeToTray',
          document.getElementById('closeToTray').checked.toString());
        await window.settingsAPI.setPreference('fontSize',
          document.getElementById('fontSize').value);
        await window.settingsAPI.setPreference('webglRenderer',
          document.getElementById('webglRenderer').checked.toString());

        markSaved();
        window.close();
      } catch (err) {
        console.error('Failed to save settings:', err);
        alert('Failed to save settings: ' + err.message);
      }
    }

    // Close on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') window.close();
    });

    // Load settings when page loads
    loadSettings();
  </script>
</body>
</html>
